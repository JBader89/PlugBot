/*! wikijs 2014-06-12 */
!function(){function a(a,b){this.title=a,this.originalTitle=b||a}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q="undefined"!=typeof process&&process.nextTick?function(a,b,c){process.nextTick(function(){a.apply(b,c)})}:function(a,b,c){setTimeout(function(){a.apply(b,c)},0)},r=function(a){return"function"==typeof a[a.length-1]?a[a.length-1]:function(){}},s=function(a,b){var c=[];if(a instanceof Array||"number"==typeof a.length)for(var d=0;d<a.length;d++)c.push(b(a[d]));else{if("function"!=typeof a.next)throw"Object is not iterable";for(var d;null!=(d=a.next());)c.push(b(d))}return c},t=function(a,b){var c=[];for(var d in a)c.push(b(d,a[d]));return c};b=require("request"),c="http://en.wikipedia.org/w/api.php",d=10,e=!1,f=!0,g=!0,h=!1,i="",j=1,k="max",l=1e3,m=!0,n={apiUrl:c,verbose:m},n.request=function(a){function c(){if(null!=arguments[0])throw arguments[0];return f=arguments[1],g=arguments[2],h=arguments[3],i=[null,JSON.parse(g)],q(j,d,i)}var d,e,f,g,h,i,j=r(arguments);d=this;try{return a.format="json",a.action="query",e={uri:n.apiUrl,qs:a,headers:{"User-Agent":"WikiJs/0.1 (https://github.com/rompetoto/wiki; richard.vanderdys@gmail.com)"}},b.get(e,c)}catch(k){if(j)return q(j,d,[k]);throw k}return j?q(j,d):void 0},n.search=function(a,b,c){function f(){if(null!=arguments[0])throw arguments[0];return i=arguments[1],j=s(i.query.search,function(a){return k=a,k.title}),c===!0&&null!=i.query.searchinfo?(l=[null,j,i.query.searchinfo.suggestion],q(m,g,l)):(l=[null,j],q(m,g,l))}var g,h,i,j,k,l,m=r(arguments);g=this,(null==b||b==m)&&(b=d),(null==c||c==m)&&(c=e);try{return h={list:"search",srprop:"",srlimit:b,srsearch:a},c===!0&&(h.srinfo="suggestion"),n.request(h,f)}catch(o){if(m)return q(m,g,[o]);throw o}return m?q(m,g):void 0},n.random=function(a){function b(){if(null!=arguments[0])throw arguments[0];return d=arguments[1],f=[null,s(d.query.random,function(a){return e=a,e.title})],q(g,c,f)}var c,d,e,f,g=r(arguments);c=this,(null==a||a==g)&&(a=j);try{return n.request({list:"random",rnnamespace:0,rnlimit:a},b)}catch(h){if(g)return q(g,c,[h]);throw h}return g?q(g,c):void 0},n.page=function(b,c){function d(){function c(){function c(){try{if(null!=arguments[0])throw arguments[0];return k=arguments[1],l=[null,j],q(m,g,l)}catch(a){throw{name:"PageError",message:b,original:a}}}try{return b=i||h[0],j=new a(b),j.load(c)}catch(d){throw{name:"PageError",message:b,original:d}}}if(null!=arguments[0])throw arguments[0];return h=arguments[1],i=arguments[2],0===h.length?m.apply(g,[{name:"NoArticle",message:"Article doesnt exist",suggestion:i}]):q(c,g)}function e(){if(null!=arguments[0])throw arguments[0];return k=arguments[1],l=[null,j],q(m,g,l)}var g,h,i,j,k,l,m=r(arguments);g=this,(null==c||c==m)&&(c=f);try{return c===!0?n.search(b,1,!0,d):(j=new a(b),j.load(e))}catch(o){if(m)return q(m,g,[o]);throw o}return m?q(m,g):void 0},n.geoSearch=function(a,b,c){function d(){if(null!=arguments[0])throw arguments[0];return f=arguments[1],h=[null,s(f.query.geosearch,function(a){return g=a,g.title})],q(i,e,h)}var e,f,g,h,i=r(arguments);e=this,(null==c||c==i)&&(c=l);try{return n.request({list:"geosearch",gsradius:c,gscoord:a+"|"+b},d)}catch(j){if(i)return q(i,e,[j]);throw j}return i?q(i,e):void 0},a.prototype.load=function(){function a(){if(null!=arguments[0])throw arguments[0];return c=arguments[1],b.pageId=Object.keys(c.query.pages)[0],b.url=c.query.pages[b.pageId].fullurl,d=[null,!0],q(e,b,d)}var b,c,d,e=r(arguments);b=this;try{return n.request({prop:"info|pageprops",inprop:"url",ppprop:"disambiguation",titles:b.title},a)}catch(f){if(e)return q(e,b,[f]);throw f}return e?q(e,b):void 0},a.prototype._helper=function(a,b){function c(){if(null!=arguments[0])throw arguments[0];return f=arguments[1],d[a]=f.query.pages[d.pageId].extract,e=[null,d[a]],q(g,d,e)}var d,e,f,g=r(arguments);d=this;try{return null!=d[a]?(e=[null,d[a]],q(g,d,e)):n.request(b,c)}catch(h){if(g)return q(g,d,[h]);throw h}return g?q(g,d):void 0},a.prototype.queryContinue=function(a,b,c,d,e,f){function g(){function f(){if(null!=arguments[0])throw arguments[0];return m=arguments[1],o=[null,m],q(p,h,o)}function g(){var a="function"==typeof p?p:function(){};return p=function(){},a()}if(null!=arguments[0])throw arguments[0];return i=arguments[1],j=null!=a.list?i.query[a.list]:i.query.pages[h.pageId][a.prop],e+=j.length,d(j),a[b+"continue"]=null,null!=i["query-continue"]&&(c===k||c>e)?(l=null!=a.list?i["query-continue"][a.list][b+"continue"]:i["query-continue"][a.prop][b+"continue"],h.queryContinue(a,b,c,d,e,l,f)):q(g,h)}var h,i,j,l,m,o,p=r(arguments);h=this,(null==e||e==p)&&(e=0),(null==f||f==p)&&(f=!1);try{return f!==!1&&(a[b+"continue"]=f),a[b+"limit"]=c,n.request(a,g)}catch(s){if(p)return q(p,h,[s]);throw s}return p?q(p,h):void 0},a.prototype.html=function(){function a(){if(null!=arguments[0])throw arguments[0];return e=arguments[1],b._html=e.query.pages[b.pageId].revisions[0]["*"],c=[null,b._html],q(f,b,c)}var b,c,d,e,f=r(arguments);b=this;try{return null!=b._html?(c=[null,b._html],q(f,b,c)):(d={prop:"revisions",rvprop:"content",rvlimit:1,rvparse:"",titles:b.title},n.request(d,a))}catch(g){if(f)return q(f,b,[g]);throw g}return f?q(f,b):void 0},a.prototype.content=function(){function a(){if(null!=arguments[0])throw arguments[0];return d=arguments[1],e=[null,d],q(f,b,e)}var b,c,d,e,f=r(arguments);b=this;try{return c={prop:"extracts",explaintext:"",titles:b.title},b._helper("_content",c,a)}catch(g){if(f)return q(f,b,[g]);throw g}return f?q(f,b):void 0},a.prototype.summary=function(){function a(){if(null!=arguments[0])throw arguments[0];return d=arguments[1],e=[null,d],q(f,b,e)}var b,c,d,e,f=r(arguments);b=this;try{return c={prop:"extracts",explaintext:"",exintro:"",titles:b.title},b._helper("_summary",c,a)}catch(g){if(f)return q(f,b,[g]);throw g}return f?q(f,b):void 0},a.prototype.images=function(){function a(){if(null!=arguments[0])throw arguments[0];return d=arguments[1],b._images=d.query?t(d.query.pages,function(a,b){return e=b,e.imageinfo[0].url}):[],c=[null,b._images],q(f,b,c)}var b,c,d,e,f=r(arguments);b=this;try{return null!=b._images?(c=[null,b._images],q(f,b,c)):n.request({generator:"images",gimlimit:"max",prop:"imageinfo",iiprop:"url",titles:b.title},a)}catch(g){if(f)return q(f,b,[g]);throw g}return f?q(f,b):void 0},a.prototype.references=function(){function a(){if(null!=arguments[0])throw arguments[0];return d=arguments[1],e=d.query.pages[b.pageId].extlinks,b._references=s(e,function(a){return f=a,o(f["*"])}),c=[null,b._references],q(g,b,c)}var b,c,d,e,f,g=r(arguments);b=this;try{return null!=b._references?(c=[null,b._references],q(g,b,c)):n.request({prop:"extlinks",ellimit:"max",titles:b.title},a)}catch(h){if(g)return q(g,b,[h]);throw h}return g?q(g,b):void 0},a.prototype.links=function(a){function b(){if(null!=arguments[0])throw arguments[0];return f=arguments[1],d=[null,c._links],q(g,c,d)}var c,d,e,f,g=r(arguments);c=this,(null==a||a==g)&&(a=k);try{return null!=c._links?(d=[null,c._links],q(g,c,d)):(c._links=[],e={prop:"links",plnamespace:0,titles:c.title},c.queryContinue(e,"pl",a,function(a){var b;c._links.extend(s(a,function(a){return b=a,b.title}))},b))}catch(h){if(g)return q(g,c,[h]);throw h}return g?q(g,c):void 0},a.prototype.withinCategory=function(a){function b(){if(null!=arguments[0])throw arguments[0];return e=arguments[1],d=[null,1===e.query.pages[c.pageId].categories.length],q(f,c,d)}var c,d,e,f=r(arguments);c=this;try{return null!=c._categories?(d=[null,c._categories.contains(a)],q(f,c,d)):n.request({prop:"categories",cllimit:1,clcategories:a,titles:c.title},b)}catch(g){if(f)return q(f,c,[g]);throw g}return f?q(f,c):void 0},a.prototype.categories=function(a){function b(){if(null!=arguments[0])throw arguments[0];return f=arguments[1],d=[null,c._categories],q(g,c,d)}var c,d,e,f,g=r(arguments);c=this,(null==a||a==g)&&(a=k);try{return null!=c._categories?(d=[null,c._categories],q(g,c,d)):(c._categories=[],e={prop:"categories",titles:c.title},c.queryContinue(e,"cl",a,function(a){var b;c._categories.extend(s(a,function(a){return b=a,b.title}))},b))}catch(h){if(g)return q(g,c,[h]);throw h}return g?q(g,c):void 0},a.prototype.coordinates=function(){function a(){if(null!=arguments[0])throw arguments[0];return d=arguments[1],b._coordinates=d.query.pages[b.pageId].coordinates[0],c=[null,b._coordinates],q(e,b,c)}var b,c,d,e=r(arguments);b=this;try{return null!=b._coordinates?(c=[null,b._coordinates],q(e,b,c)):n.request({prop:"coordinates",titles:b.title},a)}catch(f){if(e)return q(e,b,[f]);throw f}return e?q(e,b):void 0},a.prototype.infobox=function(){function a(){if(null!=arguments[0])throw arguments[0];return d=arguments[1],b._infobox=d.query.pages[b.pageId].revisions[0]["*"],c=[null,b._infobox],q(e,b,c)}var b,c,d,e=r(arguments);b=this;try{return null!=b._infobox?(c=[null,b._infobox],q(e,b,c)):n.request({prop:"revisions",rvprop:"content",rvsection:0,titles:b.title},a)}catch(f){if(e)return q(e,b,[f]);throw f}return e?q(e,b):void 0},a.prototype.info=function(){function a(){if(null!=arguments[0])throw arguments[0];return d=arguments[1],d=d.substring(d.indexOf("|")),d=d.substring(0,d.lastIndexOf("}}")),e=d.split("\n"),e.forEach(function(a){function c(){}var d,e,f;return d=a.indexOf("="),-1!==d&&(e=a.substring(1,d).trim().replace(/\s/g,"_"),f=a.substring(d+1,a.length).trim().replace(/[^\w()\s.]/g,""),0!==e.length&&0!==f.length&&(b._info[e]=f)),q(c,b)}),b._info[Object.keys(b._info).pop()]=null,c=[null,b._info],q(f,b,c)}var b,c,d,e,f=r(arguments);b=this;try{return null!=b._info?(c=[null,b._info],q(f,b,c)):(b._info={},b.infobox(a))}catch(g){if(f)return q(f,b,[g]);throw g}return f?q(f,b):void 0},a.prototype.backlinks=function(a){function b(){if(null!=arguments[0])throw arguments[0];return f=arguments[1],d=[null,c._backlinks],q(g,c,d)}var c,d,e,f,g=r(arguments);c=this,(null==a||a==g)&&(a=k);try{return null!=c._backlinks?(d=[null,c._backlinks],q(g,c,d)):(c._backlinks=[],e={list:"backlinks",bltitle:c.title},c.queryContinue(e,"bl",a,function(a){var b;c._backlinks.extend(s(a,function(a){return b=a,b.title}))},b))}catch(h){if(g)return q(g,c,[h]);throw h}return g?q(g,c):void 0},Array.prototype.extend=function(a){this.push.apply(this,a)},Array.prototype.contains=function(a){return-1!==this.indexOf(a)},String.prototype.startsWith=function(a){return 0===this.indexOf(a)},o=function(a){return a.startsWith("http")?a:"http:"+a},p=function(a){n.verbose===!0?console.log(a):void 0},module.exports=n}();